FROM golang:1.20.2 AS builder

ARG APP_RELATIVE_PATH
ARG APP_NAME
ARG VERSION

COPY . /src
WORKDIR /src/simple-zero-go/app/${APP_RELATIVE_PATH}

#  #12 52.88 error obtaining VCS status: exit status 128
RUN go env -w GOFLAGS="-buildvcs=false"
RUN GOPROXY=https://goproxy.cn,direct make build

FROM debian:stable-slim
MAINTAINER "leiax00@outlook.com"

ARG APP_RELATIVE_PATH
COPY --from=builder /src/simple-zero-go/app/${APP_RELATIVE_PATH}/bin /app
COPY --from=builder /src/simple-zero-go/app/${APP_RELATIVE_PATH}/configs /data/conf
WORKDIR /app
EXPOSE 8080

CMD ["./cmd", "-conf", "/data/conf"]