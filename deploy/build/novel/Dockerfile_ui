FROM node:lts-alpine3.15 as builder
MAINTAINER "leiax00@outlook.com"

COPY ./simple-zero-ui /code
COPY ./deploy/build/novel/Caddyfile /code/Caddyfile
WORKDIR /code
RUN ls -al && npm install -g pnpm && pnpm i && pnpm -F sz-novel build:novel

FROM caddy:2.6.2-alpine
MAINTAINER "leiax00@outlook.com"

ARG WORK_DIR="/home/serve"
COPY --from=builder /code/apps/novel/dist ${WORK_DIR}/
COPY --from=builder /code/Caddyfile /etc/caddy/Caddyfile

EXPOSE 10001
WORKDIR ${WORK_DIR}
RUN ls -al
